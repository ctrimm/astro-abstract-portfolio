---
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { getPath } from '@/utils/paths';

type ProjectEntry = CollectionEntry<'projects'>;

const allProjects = await getCollection('projects');
const sortedProjects = allProjects.sort(
  (a: ProjectEntry, b: ProjectEntry) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);
---

<BaseLayout
  title="Work | Portfolio"
  description="Brutalist portfolio showcase."
>
  <div class="min-h-screen bg-black text-white p-4">
    <!-- Header -->
    <header class="mb-20 pt-20 border-b-8 border-white pb-8">
      <h1 class="font-display text-[12vw] leading-none uppercase mix-blend-difference select-none">
        SELECTED_WORK
      </h1>
      <div class="flex justify-between items-end font-mono text-xl mt-4">
        <span>[ARCHIVE]</span>
        <span>{sortedProjects.length} PROJECTS FOUND</span>
      </div>
    </header>

    <!-- Projects List -->
    <div class="space-y-32">
      {sortedProjects.map((project: ProjectEntry, index: number) => (
        <a href={getPath(`/work/${project.id}/`)} class="block group relative">
          <div class="border-4 border-white p-4 md:p-12 transition-all group-hover:bg-white group-hover:text-black">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-8">
              <div>
                <span class="font-mono text-xl mb-4 block">0{index + 1} // {project.data.publishDate.getFullYear()}</span>
                <h2 class="font-display text-6xl md:text-8xl uppercase leading-none break-words group-hover:translate-x-4 transition-transform">
                  {project.data.title}
                </h2>
              </div>
              
              <div class="font-mono text-xl uppercase max-w-xs text-right hidden md:block group-hover:text-black">
                {project.data.description}
                <br>
                <span class="inline-block mt-4 bg-white text-black px-2 py-1 group-hover:bg-black group-hover:text-white">
                  VIEW_PROJECT ->
                </span>
              </div>
            </div>
            
            <!-- Tags -->
            <div class="mt-8 flex flex-wrap gap-4">
              {project.data.tags?.map((tag: string) => (
                <span class="border-2 border-current px-3 py-1 font-mono text-sm uppercase">
                  {tag}
                </span>
              ))}
            </div>
          </div>
        </a>
      ))}
    </div>
    
    <div class="mt-32 font-display text-center text-8xl md:text-[15rem] leading-none opacity-20 select-none">
      EOF
    </div>
  </div>
</BaseLayout>
