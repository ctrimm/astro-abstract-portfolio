---
import BaseLayout from '@layouts/BaseLayout.astro';
import ProjectCard from '@components/cards/ProjectCard.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('projects');
const sortedProjects = allProjects.sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

const categories = [...new Set(allProjects.map((p) => p.data.category))];
---

<BaseLayout
  title="Work | Portfolio"
  description="Browse my portfolio of web design, branding, and development projects."
>
  <section class="py-24">
    <div class="container mx-auto px-4">
      <div class="max-w-2xl mb-16">
        <h1 class="text-4xl md:text-5xl font-bold mb-6" transition:name="page-title">
          Selected Work
        </h1>
        <p class="text-lg text-foreground-secondary">
          A collection of projects I've worked on, from web applications to brand identities.
        </p>
      </div>

      <!-- Filter Tabs -->
      <div class="flex flex-wrap gap-2 mb-12" id="filter-container">
        <button
          class="filter-btn px-4 py-2 rounded-full bg-accent text-white text-sm font-medium hover:bg-accent-light transition-colors"
          data-filter="all"
        >
          All
        </button>
        {categories.map((cat) => (
          <button
            class="filter-btn px-4 py-2 rounded-full bg-background-secondary text-sm font-medium hover:bg-accent hover:text-white transition-colors"
            data-filter={cat}
          >
            {cat.replace('-', ' ')}
          </button>
        ))}
      </div>

      <!-- Project Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="projects-grid">
        {sortedProjects.map((project, index) => (
          <div class="project-item" data-category={project.data.category}>
            <ProjectCard project={project} index={index} />
          </div>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  function initFilters() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const projectItems = document.querySelectorAll('.project-item');

    filterBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        const filter = btn.getAttribute('data-filter');

        // Update active button
        filterBtns.forEach((b) => {
          b.classList.remove('bg-accent', 'text-white');
          b.classList.add('bg-background-secondary');
        });
        btn.classList.add('bg-accent', 'text-white');
        btn.classList.remove('bg-background-secondary');

        // Filter projects
        projectItems.forEach((item) => {
          const category = item.getAttribute('data-category');
          if (filter === 'all' || category === filter) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
      });
    });
  }

  initFilters();

  document.addEventListener('astro:page-load', () => {
    initFilters();
  });
</script>
